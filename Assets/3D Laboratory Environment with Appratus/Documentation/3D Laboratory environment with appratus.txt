using UnityEngine;
using UnityEngine.UI;

public class ClickableObject : MonoBehaviour
{
    [Header("카메라 이동 대상")]
    public Transform cameraFocusPoint;      // 문 앞으로 카메라 이동할 위치
    public Transform cameraReturnPoint;     // 카메라가 돌아갈 원래 위치

    [Header("문 애니메이터")]
    public Animator doorAnimator;
    public string openTrigger = "Open";
    public string closeTrigger = "Close";

    [Header("UI")]
    public GameObject backButton;           // 뒤로가기 버튼 (비활성 상태로 시작)

    [Header("콜라이더 관련")]
    public float disableColliderDelay = 0.2f;

    private bool hasOpened = false;
    private Collider col;

    private void Start()
    {
        col = GetComponent<Collider>();
        if (backButton != null)
            backButton.SetActive(false); // 시작 시 버튼 숨김
    }

    private void OnMouseDown()
    {
        if (hasOpened) return;
        hasOpened = true;

        Debug.Log("문 클릭됨 → 열기");

        // 카메라 이동
        if (cameraFocusPoint != null)
            Camera.main.GetComponent<CameraController>().SetTarget(cameraFocusPoint);

        // 문 열기 애니메이션
        if (doorAnimator != null)
            doorAnimator.SetTrigger(openTrigger);

        // Collider 꺼주기 (문 클릭 방지)
        Invoke(nameof(DisableCollider), disableColliderDelay);

        // 뒤로가기 버튼 표시
        if (backButton != null)
            backButton.SetActive(true);
    }

    private void DisableCollider()
    {
        if (col != null)
        {
            col.enabled = false;
            Debug.Log("문 Collider 비활성화");
        }
    }

    // 🔙 UI 버튼에서 이 메서드를 호출
    public void CloseAndReturn()
    {
        Debug.Log("뒤로가기 버튼 클릭됨 → 문 닫기 & 카메라 복귀");

        hasOpened = false;

        // 문 닫기 애니메이션
        if (doorAnimator != null)
            doorAnimator.SetTrigger(closeTrigger);

        // 카메라 원래 위치로 이동
        if (cameraReturnPoint != null)
            Camera.main.GetComponent<CameraController>().SetTarget(cameraReturnPoint);

        // Collider 다시 활성화 (닫힌 후 클릭 가능하게)
        Invoke(nameof(EnableCollider), 0.5f);

        // 버튼 숨기기
        if (backButton != null)
            backButton.SetActive(false);
    }

    private void EnableCollider()
    {
        if (col != null)
        {
            col.enabled = true;
            Debug.Log("문 Collider 다시 활성화");
        }
    }
}

git config --global user.name "YangJangyeob"
git config --global user.email "sduck0712@gmail.com"


 