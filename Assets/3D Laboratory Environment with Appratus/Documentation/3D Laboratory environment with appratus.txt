using UnityEngine;
using UnityEngine.UI;

public class ClickableObject : MonoBehaviour
{
    [Header("ì¹´ë©”ë¼ ì´ë™ ëŒ€ìƒ")]
    public Transform cameraFocusPoint;      // ë¬¸ ì•ìœ¼ë¡œ ì¹´ë©”ë¼ ì´ë™í•  ìœ„ì¹˜
    public Transform cameraReturnPoint;     // ì¹´ë©”ë¼ê°€ ëŒì•„ê°ˆ ì›ë˜ ìœ„ì¹˜

    [Header("ë¬¸ ì• ë‹ˆë©”ì´í„°")]
    public Animator doorAnimator;
    public string openTrigger = "Open";
    public string closeTrigger = "Close";

    [Header("UI")]
    public GameObject backButton;           // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ (ë¹„í™œì„± ìƒíƒœë¡œ ì‹œì‘)

    [Header("ì½œë¼ì´ë” ê´€ë ¨")]
    public float disableColliderDelay = 0.2f;

    private bool hasOpened = false;
    private Collider col;

    private void Start()
    {
        col = GetComponent<Collider>();
        if (backButton != null)
            backButton.SetActive(false); // ì‹œì‘ ì‹œ ë²„íŠ¼ ìˆ¨ê¹€
    }

    private void OnMouseDown()
    {
        if (hasOpened) return;
        hasOpened = true;

        Debug.Log("ë¬¸ í´ë¦­ë¨ â†’ ì—´ê¸°");

        // ì¹´ë©”ë¼ ì´ë™
        if (cameraFocusPoint != null)
            Camera.main.GetComponent<CameraController>().SetTarget(cameraFocusPoint);

        // ë¬¸ ì—´ê¸° ì• ë‹ˆë©”ì´ì…˜
        if (doorAnimator != null)
            doorAnimator.SetTrigger(openTrigger);

        // Collider êº¼ì£¼ê¸° (ë¬¸ í´ë¦­ ë°©ì§€)
        Invoke(nameof(DisableCollider), disableColliderDelay);

        // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í‘œì‹œ
        if (backButton != null)
            backButton.SetActive(true);
    }

    private void DisableCollider()
    {
        if (col != null)
        {
            col.enabled = false;
            Debug.Log("ë¬¸ Collider ë¹„í™œì„±í™”");
        }
    }

    // ğŸ”™ UI ë²„íŠ¼ì—ì„œ ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œ
    public void CloseAndReturn()
    {
        Debug.Log("ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ë¨ â†’ ë¬¸ ë‹«ê¸° & ì¹´ë©”ë¼ ë³µê·€");

        hasOpened = false;

        // ë¬¸ ë‹«ê¸° ì• ë‹ˆë©”ì´ì…˜
        if (doorAnimator != null)
            doorAnimator.SetTrigger(closeTrigger);

        // ì¹´ë©”ë¼ ì›ë˜ ìœ„ì¹˜ë¡œ ì´ë™
        if (cameraReturnPoint != null)
            Camera.main.GetComponent<CameraController>().SetTarget(cameraReturnPoint);

        // Collider ë‹¤ì‹œ í™œì„±í™” (ë‹«íŒ í›„ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ)
        Invoke(nameof(EnableCollider), 0.5f);

        // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        if (backButton != null)
            backButton.SetActive(false);
    }

    private void EnableCollider()
    {
        if (col != null)
        {
            col.enabled = true;
            Debug.Log("ë¬¸ Collider ë‹¤ì‹œ í™œì„±í™”");
        }
    }
}

git config --global user.name "YangJangyeob"
git config --global user.email "sduck0712@gmail.com"


 